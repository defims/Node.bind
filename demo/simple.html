<!doctype html>
<head>
    <script src="../../DefineProperty.polyfill/DefineProperty.polyfill.js"></script>
    <script src="../../Array.observe/Array.observe.js"></script>
    <script src="../Node.bind.js"></script>
</head>
<body>
    <!--<div
        data-bind-textContent="{{obj.path[0].to[0].value}}"
        data-bind-attribute-id=""
        data-bind-attribute-class=""
        data-bind-attribute-style=""
        data-bind-attribute-style-top=""
        data-bind-attribute-custom-define=""
        data-bind-dataset-a-b=""
        data-bind-event-click=""
        data-bind-childnode-1-nodevalue=""
        data-bind-scope
    ></div>
    <input
        data-bind-attribute-value=""
    />
    -->
    <div id="textContent"></div>
    <div>
        <div id="nestScope">
            <div id="objectChild"></div>
            <div id="objectChild2"></div>
            <div id="objectChild3"></div>
        </div>
    </div>
    <!--
    <ul>
        <li
            data-bind-repeat=""
        >elementArray</li>
    </ul>
    -->
    <ul class="repeat">
        <li class="textContent">*</li>
    </ul>
<div id='elementBoolean'></div>
<div id='elementNumber'></div>
<script>
var data ={
    obj     : {
        path    : [{
            to  : [{
                value : 'content'
            }]
        }]
    },
    arr     : [1,2,3,4],
    bool    : true,
    num     : 90,
    handle  : function(){
        //observe(target, callback);
    }
};
var $   = function(selector){
    return document.querySelectorAll(selector)
}
//NodeBind($('#textContent'), 'textContent', data, '{{obj.path[0].to[0].value}}');
NodeBind($('.repeat'), 'repeat', data, '{{arr}}');
NodeBind($('.repeat .textContent'), 'textContent', '{{$index}}')
//NodeBind(document.getElementById('elementObject'), 'textContent', data, '{{obj.path[0].to[0].value}}');
//Node(node, 'textContent').bind(data, 'content');
//Node(node).bind('textContent', data, 'content');
//data.path.to.value    = 'hi';
//NodeBind(document.getElementById('elementObject')).bind('data');
//NodeBind(document.getElementById('nestScope')).bind('obj');
//NodeBind(document.getElementById('objectChild')).bind('path[0].to[0].value');
//NodeBind(document.getElementById('objectChild2')).bind('arr[0]');//#nestScope's nodeBindData hasn't arr[0],so search parentScope and find data.arr[0]
//if Array item is bind before, after binding will replace it
//NodeBind(document.getElementsByClassName('elementArray')).bind('data.arr');
//NodeBind(document.getElementsByClassName('arrayChild')).bind('$i');/*$i will be replaced with the repeat index*/

//NodeBind(document.getElementById('elementBoolean')).bind('data.bool');
//NodeBind(document.getElementById('elementNumber')).bind('data.num');
setTimeout(function(){
    data.obj.path[0].to[0].value = 'modify content'
    //data.bool   = false;
    //data.num    = 100;
    //data.arr[0] = 20;
    //data.arr.push(5);
    //data.arr.push(6);
    //data.arr.push(9);
    //data.arr.push({a: 3});
    ////data.arr[4] = 5;
    //console.log(data.arr)
    //data.arr.push(6);
    //data.arr.pop();
    //data.arr.push({"foo":"bar"})
    //data.arr.push({"foo":"bar"})
    //data.arr[2] = 4;
},1000)
</script>
<script>
/*
node(node).attribute        = object(object).attribute;
object(object).attribute    = node(node).attribute;
node(node)[attribute]       = object(object)[attribute];
object(object)[attribute]   = node(node)[attribute];
*/
/*
Bind(Element, 'attribute', object, 'property');
Bind.prototype.bind = function(name, object, property){
    if(name == 'myBinding'){
    }else Bind.prototype.prototype.bind.call(this, name, object, property);
}
*/
/*
Node(node,attribute).bind(object,attribute)
*

;(function(){

    function attr(node, attr){
        this.node       = node;
        this.attribute  = attr;
    };

    attr.prototype.bind = function(obj, objAttr){
        var node                    = this.node,
            nodeAttr                = this.attribute,
            nodeType                = node.nodeType,
            defineProperty          = Object.defineProperty,
            _nodeVal                = node[nodeAttr],
            _objVal                 = obj[objAttr];
        //set node and nodeAttr
        //if(nodeType == 1 && nodeAttr  == 'textContent'){
        //    var childNodes  = node.childNodes,
        //        len         = childNodes.length,
        //        i,childNode;

        //    if(len){
        //        for(i=0; i<childNodes.length; i++){
        //            childNode   = childNodes[i];
        //            if(childNode.nodeType == 3){
        //                node        = childNode;
        //                break;  
        //            }
        //        }
        //    }else{
        //        var childNode   = document.createTextNode();
        //        node.appendChild(childNode);
        //        node    = childNode;
        //    }
        //    nodeAttr    = 'nodeValue';
        //};

        var _nodeGetterSetter   = Object.getOwnPropertyDescriptor(node, nodeAttr),
            _objGetterSetter    = Object.getOwnPropertyDescriptor(obj, objAttr);
        console.log(_nodeGetterSetter);
        _nodeGetterSetter.value = 1;
        console.log(_nodeGetterSetter,node);
        //_nodeGetterSetter.value='hi88';
        //console.log(_nodeGetterSetter, _objGetterSetter);
        //node[nodeAttr] getter setter  

        //var _copyNode = {}
        //defineProperty(_copyNode, nodeAttr, _nodeGetterSetter);
        //defineProperty(node, nodeAttr, {
        //    get: function(){
        //        return _nodeGetterSetter.value;
        //    },
        //    set: function(value){
        //        console.log('node setter')
        //        //_objGetterSetter.value    = value;
        //        _nodeGetterSetter.value = value;
        //        //_copyNode[nodeAttr]   = value;
        //    }
        //});
        //obj[objAttr] getter setter
        defineProperty(obj, objAttr, {
            get:function(){
                return _objGetterSetter.value;
            },
            set:function(value){
                _objGetterSetter.value  = value;
                node[nodeAttr]  = value;
                //_nodeGetterSetter.value   = value;
            }
        });

        //init node
        node[nodeAttr]  = obj[objAttr];
        //console.log(node,nodeAttr,node[nodeAttr],obj,objAttr,obj[objAttr]);
        //console.log(Object.getOwnPropertyDescriptor(node, nodeAttr));
        //console.log(Object.getOwnPropertyDescriptor(_copyNode, nodeAttr));

    };

    function Node(node, attribute){
        return new attr(node, attribute);
    };

    window.Node = Node;
})();
*/
/*
var observer = new PathObserver(obj, 'foo.bar.baz', function(newValue, oldValue) { // respond to obj.foo.bar.baz having changed value. });
var observer = new ArrayObserver(arr, function(splices) {
  // respond to changes to the elements of arr.
  splices.forEach(function(splice) {
    splice.index; // index position that the change occurred.
    splice.removed; // an array of values representing the sequence of elements which were removed
    splice.addedCount; // the number of elements which were inserted.
  });
});
var observer = new ObjectObserver(obj, function(added, removed, changed, getOldValueFn) {
  // respond to changes to the obj.
  Object.keys(added).forEach(function(property) {
    property; // a property which has been been added to obj
    added[property]; // its value
  });
  Object.keys(removed).forEach(function(property) {
    property; // a property which has been been removed from obj
    getOldValueFn(property); // its old value
  });
  Object.keys(changed).forEach(function(property) {
    property; // a property on obj which has changed value.
    changed[property]; // its value
    getOldValueFn(property); // its old value
  });
});
*/
/*
if (!Array.prototype.forEach) {
    Array.prototype.forEach = function (fn, scope) {
        'use strict';
        var i, len;
        for (i = 0, len = this.length; i < len; ++i) {
            if (i in this) {
                fn.call(scope, this[i], i, this);
            }
        }
    };
}
*/

</script>
</body>
</html>
